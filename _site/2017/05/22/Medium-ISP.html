<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>Medium ISP: Word Clock and Weather Predictor | Ethan McAuliffe's Blog</title>
	<meta name="description" content="PurposeThe purpose of this project is to create a clock capable of showing the current time, temperature, humidity and short-term forecast in a clean, sleek ...">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="https://emcauliffe.ca/Images/favicon.png" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="/2017/05/22/Medium-ISP.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Ethan McAuliffe's Blog" href="/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-113342409-1', 'auto');
	ga('send', 'pageview');
	</script>
	
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

	<script>
	  (adsbygoogle = window.adsbygoogle || []).push({
	    google_ad_client: "ca-pub-3976272342678634",
	    enable_page_level_ads: true
	  });
	</script>
	
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<h1 class="site-title">
			<a href="/">Ethan McAuliffe's Blog</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<li>
				<a class="page-link" href="/tags.html">
					tags
				</a>
			</li>
			
			
			<!-- Social icons from Font Awesome, if enabled  -->
			
<li>
	<a href="/feed.xml" title="Follow RSS feed">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>



<li>
	<a href="mailto:ethan@emcauliffe.ca" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>













<li>
	<a href="https://github.com/emcauliffe" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>







<li>
	<a href="https://www.linkedin.com/in/ethan-mcauliffe/" title="Follow on LinkedIn">
		<i class="fa fa-fw fa-linkedin"></i>
	</a>
</li>





















<li>
	<a href="https://www.youtube.com/user/ethanmrsgc" title="Follow on YouTube">
		<i class="fa fa-fw fa-youtube"></i>
	</a>
</li>



            <!-- Search bar -->
            
            <li>
            <form action="/search.html" method="get">
                <input type="text" id="search-box" name="query" placeholder="Search" class="">
                <button type="submit" class="">
                    <i class="fa fa-fw fa-search"></i>
                </button>
            </form>
            </li>
            
		</ul>
	</nav>

</header>

    <div class="content">
      <article >
  <!--<header style="background-image: url('/')">-->
  <header style="background-image: url()">
    <h1 class="title">Medium ISP: Word Clock and Weather Predictor</h1>
    
    <p class="meta">
      May 22, 2017
      
    </p>
  </header>
  <section class="post-content"><h2 id="purpose">Purpose</h2>
<p>The purpose of this project is to create a clock capable of showing the current time, temperature, humidity and short-term forecast in a clean, sleek way. The clock is to read the time off of an Real Time Clock (RTC) IC, read air pressure, humidity and temperature wirelessly from a separate device, and display everything in an easy to understand way. To display the time, words for each five minute interval and each hour are to illuminate. To display the current temperature and relative humidity percentage (%RH), the first ten columns are to light up and show the required digits, similar to a 7-segment display. A “C” and a “%” sign will also illuminate for temperature and %RH respectively. The weather sensor is to be separate from the clock and communicate with the main clock via a NRF24L01+ wireless communication IC.</p>

<table>
  <thead>
    <tr>
      <th>Parts List</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2× Arduino Uno</td>
      <td>2× NRF24L01+ Wireless Chip</td>
    </tr>
    <tr>
      <td>93× Red-Green BiColour LEDs</td>
      <td>4’×2’ Medium Density Fibreboard (MDF)</td>
    </tr>
    <tr>
      <td>Clear Acrylic Sheet</td>
      <td>Piano Black Plastic Sheet</td>
    </tr>
    <tr>
      <td>BME280 I2C or SPI Temperature Humidity Pressure Sensor</td>
      <td>DS1307 I2C Real Time Clock</td>
    </tr>
  </tbody>
</table>

<h2 id="procedure">Procedure</h2>
<p><img style="float:right" src="https://emcauliffe.ca/Images/ER%20Reports/Grade%2011/Medium%20ISP/chrome_2017-05-22_14-23-26.png" />
This project begins with designing the main clock face. It is paramount that the clock face contains all the necessary words to display any five minute interval of time. This step also requires careful planning of the order that words will appear to ensure readability (top to bottom, left to right) and that there is adequate spacing between each word. Each line must also have the same number of characters, and the “C” and “%” characters must be present only in the far-right column. Creation of the design initially began in a text file, and was then transferred to a table in a word document to add colour. Creation of the final design required using a CAD program, in this case ViaCAD 3D, to ensure proper spacing of characters. Mr. Elia helped greatly with this. The final step in designing the clock face was sending the design files off to be laser cut in acrylic and plastic. Assembly began when the laser cut pieces arrived. Gluing the characters  into place meant ensuring that the block shape of each was clear acrylic, and the inner “floating” parts of the characters were the same black plastic as the rest of the clock face. This allowed for avoiding a stencil font while still maintaining readability. </p>

<p>Creating the wireless weather sensor was the next step. This began with reading the datasheet to understand where to find data on the IC and how to access it using Serial Peripheral Interface (SPI). Pictured on the previous page is the pinout for the BME280 sensor. It is a surface mount device.</p>

<p>SPI works similar to serial communication, but with the added benefit of the slave device (in this case the BME280 sensor) being able to contact the master device as well (in this case the Arduino Uno). Unlike I2C, it requires 4 pins. See Wireless Communication: Temperature Data Logging for more information on Serial Communication. SPI is the chosen protocol in this case because it means using only one communication protocol to interact with the wireless transmitter and the weather sensor.</p>

<p>Configuring the BME280 chip is important so that that reports the values as desired. The <code class="highlighter-rouge">sensorConfig() </code> function configures the sensor by performing a reset, identifying how often the sensor is to record information, and how sensitive the sensor should be to sudden changes in values. It also initiates <code class="highlighter-rouge">getCompensationData()</code>.</p>

<p>The data from the BME280 chip requires processing before it can accurately display the time. This is because each individual chip has different sensitivities to the environment. The manufacturer, Bosch, solves this problem by storing “compensation data” in specific registers on the chip. The <code class="highlighter-rouge">getCompensationData()</code> function in the Remote Sensor code obtains this data. The <code class="highlighter-rouge">getCompensationData()</code> function is only called once as the compensation data never changes. A special <code class="highlighter-rouge">struct</code> called <code class="highlighter-rouge">compData</code> stores this data because some values have different lengths, some are “signed” and some are “unsigned”. This was problematic as the datasheet provided incorrect information on which characters were signed or unsigned. by comparing the individual compensation data readouts to those of the Adafruit library, it was easy to deduce which were incorrect.</p>

<p>Signed characters use format called <em>Two’s Compliment</em> to store their values. Using an 8-bit byte as an example, two’s compliment has the ability to store a value ranging from -128 to 127 inclusive. Two’s compliment works by accepting a positive integer from 0-128, then performing a bitwise “NOT”, and adding 1. This value now represents a negative integer. The computer can tell that the value is negative, because the most significant bit of binary integer is a “1”. For more information on bitwise, see the BiColour LED Matrix project.</p>

<p>Recording the uncompensated, or “raw”, data from the sensor happens after reading the compensation data. The <code class="highlighter-rouge">getRawData()</code> function obtains said data and stores it in a <code class="highlighter-rouge">struct</code> called <code class="highlighter-rouge">rawData</code>. This data is then run through specific algorithms defined in the datasheet, which use the compensation data recorded earlier, to get the temperature in degrees Celsius, the pressure in Pascals, and the relative humidity percentage. These algorithms are <code class="highlighter-rouge">temp()</code>, <code class="highlighter-rouge">pressure()</code> and <code class="highlighter-rouge">humidity()</code> for temperature, pressure and humidity respectively. Each returns a value of specific size for easy formatting and transmission using the <code class="highlighter-rouge">transmit()</code> function.</p>

<p>The <code class="highlighter-rouge">transmit()</code> function compacts the temperature, pressure and humidity data into one unsigned, 64-bit integer, and transmits it wirelessly via the NRF24L01+. The program then uses the <code class="highlighter-rouge">deepSleep()</code> function to enter the peripherals into low power mode, wait, and then turn the sensor back on. This function uses SPI to write to a specific register on the BME280 sensor requesting that it enter sleep mode.</p>

<p>The clock code first uses I2C to intercept the current hour and minute from the DS1307 RTC. This code is works almost identically to that used in the Nixie Tube Clock project. The <code class="highlighter-rouge">updateTime()</code> function obtains this time and stores it in a <code class="highlighter-rouge">struct</code> called <code class="highlighter-rouge">currentTime</code> for easy access. This function also converts the 24-hour time stored on the RTC into 12-hour time for the clock to display.</p>

<p>The <code class="highlighter-rouge">receive()</code> function then looks for available data from the remote sensor, formats the recieved 64 bit, unsigned integer into temperature, pressure and humidity again, and then stores it in a <code class="highlighter-rouge">struct</code> called <code class="highlighter-rouge">senseData</code>.</p>

<p>The current time is then formatted into specific words and printed to the serial monitor via the <code class="highlighter-rouge">printTimeAndData()</code> function. This function first reads the current minute and maps it to a value from 0-12, inclusive. This value is then used to query the <code class="highlighter-rouge">minuteText[]</code> array and determine what text to show for the current minute. Next the function determines if the clock should display “TO” or “PAST” the hour. The clock only switches to “TO” after 35 minutes of the current hour have elapsed. The mapped value is again used to determine this. The final step in showing the current time is displaying the appropriate hour in relation to the current time. For this the current hour value minus one (because arrays are zero indexed) index of <code class="highlighter-rouge">thehourText[]</code> array prints to the serial monitor. If the minutes, however, are greater than 35, the clock must display the future hour as the clock will now show “TO” instead of “PAST”. As such the index of the current hour is directly indexed into the <code class="highlighter-rouge">hourText[]</code> array. Finally the function prints the data intercepted from the remote sensor to the serial monitor. This includes whether or not the weather is improving, or worsening.</p>

<p>The <code class="highlighter-rouge">isWeatherImproving()</code> function uses an average of the pressure from each five minute interval over the past hour plus the current pressure and compares it against the oldest pressure reading. If the average is less than the oldest reading, pressure is decreasing  and the weather is getting worse. Otherwise, the weather is improving and the function returns <code class="highlighter-rouge">true</code>.</p>

<p>While simple at first, numerous obstacles faced the construction of this clock later on. Cutting the perfectly square back plate of the clock and wooden borders of the face plate was the first step. Gluing the cardstock baffles which ensured no light bleed from neighbouring characters followed. This ensured that the clock would be easy to read. Problems arose in the final steps when planning out a NeoPixel LED matrix for backlighting, as the NeoPixels were non-functional. BiColour Red/Green LEDs replaced the NeoPixels after a last-minute visit to a hardware store. Unfortunately, however, the ATmega328P does not have enough ports to control the 93 LED matrix, and as such, the clock cannot function. Painting the clock and gluing the faceplate in position were the final steps. A possible solution to this problem would be a larger Arduino device to control the entire matrix, or (the better option) to purchase a working strip of NeoPixels.</p>

<h2 id="media">Media</h2>
<table>
  <tr>
    <td>
      <img src="https://emcauliffe.ca/Images/ER%20Reports/Grade%2011/Medium%20ISP/DSC_0034.jpg" />
    </td>
    <td>
      <img src="https://emcauliffe.ca/Images/ER%20Reports/Grade%2011/Medium%20ISP/DSC_0036.jpg" />
    </td>
  </tr>
  <tr>
    <th>Drilling holes for LEDs</th>
    <th>Soldering LED matrix</th>
  </tr>
  <tr>
    <td>
      <img src="https://emcauliffe.ca/Images/ER%20Reports/Grade%2011/Medium%20ISP/DSC_0031.jpg" />
    </td>
    <td>
      <img src="https://emcauliffe.ca/Images/ER%20Reports/Grade%2011/Medium%20ISP/DSC_0042.jpg" />
    </td>
  </tr>
  <tr>
    <th>Testing Main clock module without matrix</th>
    <th>Illuminated Clock Face</th>
  </tr>
  <tr>
    <th colspan="2">Link to YouTube Video: <a href="https://youtu.be/0zP5Rlmc7oA">https://youtu.be/0zP5Rlmc7oA</a></th>
  </tr>
</table>

<h2 id="code">Code</h2>
<h3 id="main-clock-code">Main Clock Code</h3>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;Wire.h&gt;
#include &lt;nRF24L01.h&gt;
#include &lt;printf.h&gt;
#include &lt;RF24.h&gt;
#include &lt;RF24_config.h&gt;
</span>
<span class="cp">#define RTC_ADDRESS 0x68
</span>
<span class="n">RF24</span> <span class="n">radio</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="kt">uint8_t</span> <span class="n">addresses</span><span class="p">[][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"3g8wM"</span><span class="p">,</span> <span class="s">"0Us9x"</span><span class="p">};</span>
<span class="kt">uint64_t</span> <span class="n">data</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">goodWeather</span><span class="p">;</span>
<span class="n">String</span> <span class="n">hourText</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ONE"</span><span class="p">,</span> <span class="s">"TWO"</span><span class="p">,</span> <span class="s">"THREE"</span><span class="p">,</span> <span class="s">"FOUR"</span><span class="p">,</span> <span class="s">"FIVE"</span><span class="p">,</span> <span class="s">"SIX"</span><span class="p">,</span> <span class="s">"SEVEN"</span><span class="p">,</span> <span class="s">"EIGHT"</span><span class="p">,</span> <span class="s">"NINE"</span><span class="p">,</span> <span class="s">"TEN"</span><span class="p">,</span> <span class="s">"ELEVEN"</span><span class="p">,</span> <span class="s">"TWELVE"</span><span class="p">};</span>
<span class="n">String</span> <span class="n">minuteText</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">""</span><span class="p">,</span> <span class="s">"FIVE"</span><span class="p">,</span> <span class="s">"TEN"</span><span class="p">,</span> <span class="s">"A QUARTER"</span><span class="p">,</span> <span class="s">"TWENTY"</span><span class="p">,</span> <span class="s">"TWENTY FIVE"</span><span class="p">,</span> <span class="s">"A HALF"</span><span class="p">,</span> <span class="s">"TWENTY FIVE"</span><span class="p">,</span> <span class="s">"TWENTY"</span><span class="p">,</span> <span class="s">"A QUARTER"</span><span class="p">,</span> <span class="s">"TEN"</span><span class="p">,</span> <span class="s">"FIVE"</span><span class="p">,</span> <span class="s">""</span><span class="p">};</span>
<span class="kt">uint32_t</span> <span class="n">pressureAverage</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
<span class="kt">uint8_t</span> <span class="n">durationThroughHour</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">SENSORDATA</span> <span class="p">{</span>
  <span class="kt">int8_t</span> <span class="n">temp</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">pressure</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">hum</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">CURRENT_TIME</span> <span class="p">{</span>
  <span class="kt">uint8_t</span> <span class="n">hours</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">minutes</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">SENSORDATA</span> <span class="n">senseData</span><span class="p">;</span>
<span class="n">CURRENT_TIME</span> <span class="n">currentTime</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>

  <span class="n">radio</span><span class="p">.</span><span class="n">setChannel</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span>

  <span class="n">radio</span><span class="p">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">startListening</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">updateTime</span><span class="p">();</span>
  <span class="n">receive</span><span class="p">();</span>
  <span class="n">printTimeAndData</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">receive</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">radio</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">radio</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">));</span>
    <span class="n">senseData</span><span class="p">.</span><span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int8_t</span><span class="p">)(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">40</span><span class="p">);</span>
    <span class="n">senseData</span><span class="p">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="p">((</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span> <span class="o">/</span> <span class="mf">25600.00</span><span class="p">;</span>
    <span class="n">senseData</span><span class="p">.</span><span class="n">hum</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="n">pressureAverage</span><span class="p">[</span><span class="n">durationThroughHour</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">senseData</span><span class="p">.</span><span class="n">pressure</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">updateTime</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">beginTransmission</span><span class="p">(</span><span class="n">RTC_ADDRESS</span><span class="p">);</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//prepare rtc to be read from</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">endTransmission</span><span class="p">();</span>
  <span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">RTC_ADDRESS</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Wire</span><span class="p">.</span><span class="n">available</span><span class="p">());</span>
  <span class="n">currentTime</span><span class="p">.</span><span class="n">minutes</span> <span class="o">=</span>  <span class="n">readTime</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span> <span class="c1">//minute</span>
  <span class="kt">uint8_t</span> <span class="n">hours</span> <span class="o">=</span> <span class="n">readTime</span><span class="p">(</span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">hours</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="n">hours</span> <span class="o">-</span> <span class="mi">12</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">hours</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hours</span> <span class="o">==</span> <span class="mi">12</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">currentTime</span><span class="p">.</span><span class="n">hours</span> <span class="o">=</span> <span class="n">hours</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">isWeatherImproving</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">pressureSum</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">ii</span><span class="p">;</span> <span class="n">ii</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">;</span> <span class="n">ii</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pressureSum</span> <span class="o">+=</span> <span class="n">pressureAverage</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pressureSum</span> <span class="o">/</span> <span class="mi">13</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">pressureAverage</span><span class="p">[</span><span class="mi">12</span> <span class="o">-</span> <span class="n">durationThroughHour</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">printTimeAndData</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"It is "</span><span class="p">);</span>
  <span class="n">durationThroughHour</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">currentTime</span><span class="p">.</span><span class="n">minutes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">minuteText</span><span class="p">[</span><span class="n">durationThroughHour</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">durationThroughHour</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">durationThroughHour</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" PAST "</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" TO "</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">currentTime</span><span class="p">.</span><span class="n">minutes</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">hourText</span><span class="p">[</span><span class="n">currentTime</span><span class="p">.</span><span class="n">hours</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">hourText</span><span class="p">[</span><span class="n">currentTime</span><span class="p">.</span><span class="n">hours</span><span class="p">]);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"  --  "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">senseData</span><span class="p">.</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"* C "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">senseData</span><span class="p">.</span><span class="n">pressure</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" hPa "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">senseData</span><span class="p">.</span><span class="n">hum</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"% RH "</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">isWeatherImproving</span><span class="p">()</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"IMPROVING "</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"GETTING WORSE "</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">uint8_t</span> <span class="nf">readTime</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//makes time human readable (0-60 and 0-24)</span>
  <span class="k">return</span> <span class="p">((</span><span class="n">input</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">input</span> <span class="o">%</span> <span class="mi">16</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure>

<h3 id="remote-sensor-code">Remote Sensor Code</h3>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;SPI.h&gt; // for interfacing with the data sensor
#include &lt;nRF24L01.h&gt;
#include &lt;printf.h&gt;
#include &lt;RF24.h&gt;
#include &lt;RF24_config.h&gt;
</span>
<span class="cp">#define SENSORSS 10
#define SENSORSPEED 500000
</span>
<span class="n">RF24</span> <span class="n">radio</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="kt">uint8_t</span> <span class="n">addresses</span><span class="p">[][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"3g8wM"</span><span class="p">,</span> <span class="s">"0Us9x"</span><span class="p">};</span>
<span class="kt">int32_t</span> <span class="n">currentTemp</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">SCOMP</span> <span class="p">{</span>
  <span class="kt">uint16_t</span> <span class="n">T1</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">T2</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">T3</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">P1</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">P2</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">P3</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">P4</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">P5</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">P6</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">P7</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">P8</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">P9</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">H1</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">H2</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">H3</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">H4</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">H5</span><span class="p">;</span>
  <span class="kt">int8_t</span> <span class="n">H6</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">RAWDATA</span> <span class="p">{</span>
  <span class="kt">uint32_t</span> <span class="n">uPress</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">uTemp</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">uHum</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">RAWDATA</span> <span class="n">rawRead</span><span class="p">;</span>
<span class="n">SCOMP</span> <span class="n">compData</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>

  <span class="n">radio</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>

  <span class="n">ACSR</span> <span class="o">=</span> <span class="n">B10000000</span><span class="p">;</span>
  <span class="n">ADCSRA</span> <span class="o">=</span> <span class="n">ADCSRA</span> <span class="o">&amp;</span> <span class="n">B01111111</span><span class="p">;</span>
  <span class="n">DIDR0</span> <span class="o">=</span> <span class="n">DIDR0</span> <span class="o">|</span> <span class="n">B00111111</span><span class="p">;</span>

  <span class="n">radio</span><span class="p">.</span><span class="n">setPALevel</span><span class="p">(</span><span class="n">RF24_PA_MAX</span><span class="p">);</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">setChannel</span><span class="p">(</span><span class="mi">99</span><span class="p">);</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

  <span class="n">sensorConfig</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">getRawData</span><span class="p">();</span>
  <span class="n">transmit</span><span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span><span class="p">),</span> <span class="n">pressure</span><span class="p">(</span><span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span><span class="p">),</span> <span class="n">humidity</span><span class="p">(</span><span class="n">rawRead</span><span class="p">.</span><span class="n">uHum</span><span class="p">));</span>
  <span class="n">deepSleep</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int8_t</span> <span class="nf">temp</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">inTemp</span><span class="p">)</span> <span class="p">{</span><span class="c1">//returns temp in degrees celcius int8_t</span>
  <span class="kt">int32_t</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">;</span>
  <span class="n">var1</span> <span class="o">=</span> <span class="p">((((</span><span class="n">inTemp</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">T1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">T2</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">;</span>
  <span class="n">var2</span> <span class="o">=</span> <span class="p">(((((</span><span class="n">inTemp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">T1</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">inTemp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">T1</span><span class="p">)))</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">T3</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">;</span>
  <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">var1</span> <span class="o">+</span> <span class="n">var2</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">round</span><span class="p">(((</span><span class="n">currentTemp</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">128</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.00</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int32_t</span> <span class="nf">pressure</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">inPress</span><span class="p">)</span> <span class="p">{</span><span class="c1">//returns pressure in int_32</span>
  <span class="n">temp</span><span class="p">(</span><span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span><span class="p">);</span>
  <span class="kt">int64_t</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>
  <span class="n">var1</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">currentTemp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">128000</span><span class="p">;</span>
  <span class="n">var2</span> <span class="o">=</span> <span class="n">var1</span> <span class="o">*</span> <span class="n">var1</span> <span class="o">*</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P6</span><span class="p">;</span>
  <span class="n">var2</span> <span class="o">=</span> <span class="n">var2</span> <span class="o">+</span> <span class="p">((</span><span class="n">var1</span> <span class="o">*</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P5</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">);</span>
  <span class="n">var2</span> <span class="o">=</span> <span class="n">var2</span> <span class="o">+</span> <span class="p">(((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">35</span><span class="p">);</span>
  <span class="n">var1</span> <span class="o">=</span> <span class="p">((</span><span class="n">var1</span> <span class="o">*</span> <span class="n">var1</span> <span class="o">*</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P3</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">var1</span> <span class="o">*</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
  <span class="n">var1</span> <span class="o">=</span> <span class="p">(((((</span><span class="kt">int64_t</span><span class="p">)</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">47</span><span class="p">)</span> <span class="o">+</span> <span class="n">var1</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">33</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">var1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span> <span class="c1">// avoid exception caused by division by zero</span>
  <span class="p">}</span>

  <span class="n">p</span> <span class="o">=</span> <span class="mi">1048576</span> <span class="o">-</span> <span class="n">inPress</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="p">(((</span><span class="n">p</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">-</span> <span class="n">var2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3125</span><span class="p">)</span> <span class="o">/</span> <span class="n">var1</span><span class="p">;</span>
  <span class="n">var1</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P9</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">25</span><span class="p">;</span>
  <span class="n">var2</span> <span class="o">=</span> <span class="p">(((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P8</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="n">p</span> <span class="o">+</span> <span class="n">var1</span> <span class="o">+</span> <span class="n">var2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">P7</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">uint8_t</span> <span class="nf">humidity</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">inHum</span><span class="p">)</span> <span class="p">{</span><span class="c1">//returns percent relative humidity int8_t</span>
  <span class="kt">int32_t</span> <span class="n">v1</span><span class="p">;</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">currentTemp</span> <span class="o">-</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">76800</span><span class="p">));</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="p">(((((</span><span class="n">inHum</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">-</span> <span class="p">(((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">H4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-</span> <span class="p">(((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">H5</span><span class="p">)</span> <span class="o">*</span> <span class="n">v1</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">16384</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((((((</span><span class="n">v1</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">H6</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="n">v1</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">H3</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">32768</span><span class="p">)))</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="mi">2097152</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">H2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8192</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">));</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="p">(((((</span><span class="n">v1</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">compData</span><span class="p">.</span><span class="n">H1</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">));</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">v1</span><span class="p">;</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">419430400</span><span class="p">)</span> <span class="o">?</span> <span class="mi">419430400</span> <span class="o">:</span> <span class="n">v1</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">round</span><span class="p">((</span><span class="n">v1</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1024.00</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sensorConfig</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">SENSORSPEED</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x60</span><span class="p">);</span><span class="c1">//initiate write to reset register</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xB6</span><span class="p">);</span><span class="c1">//performs soft reset</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">SENSORSPEED</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x75</span><span class="p">);</span><span class="c1">//initiate write to config</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x04</span><span class="p">);</span><span class="c1">//0.5ms delay, filter x2</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x72</span><span class="p">);</span><span class="c1">//initiate write to ctrl_hum</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x01</span><span class="p">);</span><span class="c1">//set filtering to 1x</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x74</span><span class="p">);</span><span class="c1">//initiate write to ctrl_meas</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xB7</span><span class="p">);</span><span class="c1">//normal mode</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  <span class="n">getCompensationData</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">getRawData</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">SENSORSPEED</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xF7</span><span class="p">);</span>
  <span class="c1">//pressure</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span> <span class="o">|=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span> <span class="o">|=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uPress</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="c1">//temperature</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span> <span class="o">|=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span> <span class="o">|=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uTemp</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="c1">//humidity</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uHum</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uHum</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">rawRead</span><span class="p">.</span><span class="n">uHum</span> <span class="o">|=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">transmit</span><span class="p">(</span><span class="kt">int8_t</span> <span class="n">tempD</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">pressD</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">humD</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//sends data to the main clock</span>
  <span class="kt">uint64_t</span> <span class="n">transmissionData</span><span class="p">;</span>
  <span class="n">transmissionData</span> <span class="o">=</span> <span class="n">tempD</span><span class="p">;</span>
  <span class="n">transmissionData</span> <span class="o">&lt;&lt;=</span> <span class="mi">32</span><span class="p">;</span>
  <span class="n">transmissionData</span> <span class="o">|=</span> <span class="n">pressD</span><span class="p">;</span>
  <span class="n">transmissionData</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">transmissionData</span> <span class="o">|=</span> <span class="n">humD</span><span class="p">;</span>

  <span class="n">radio</span><span class="p">.</span><span class="n">powerUp</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">transmissionData</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wakeSensor</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">SENSORSPEED</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x74</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xB7</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sensorSleep</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">SENSORSPEED</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x74</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xB4</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">deepSleep</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//powers down peripherals and ATmega328</span>
  <span class="n">sensorSleep</span><span class="p">();</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">powerDown</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>
  <span class="n">wakeSensor</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">getCompensationData</span><span class="p">()</span> <span class="p">{</span><span class="c1">//populates compData struct</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">beginTransaction</span><span class="p">(</span><span class="n">SPISettings</span><span class="p">(</span><span class="n">SENSORSPEED</span><span class="p">,</span> <span class="n">MSBFIRST</span><span class="p">,</span> <span class="n">SPI_MODE0</span><span class="p">));</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x88</span><span class="p">);</span>
  <span class="c1">//Temperature</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">T1</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">T1</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">T1</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">T1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">T2</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">T2</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">T2</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">T2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">T3</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">T3</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">T3</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">T3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="c1">//Pressure</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P1</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P1</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P1</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P2</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P2</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P2</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P3</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P3</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P3</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P4</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P4</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P4</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P4</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P5</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P5</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P5</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P5</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P6</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P6</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P6</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P6</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P7</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P7</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P7</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P8</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P8</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P8</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P8</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P9</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">P9</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">P9</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">P9</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="c1">//Humidity</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xA1</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H1</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xE1</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H2</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">));</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H2</span> <span class="o">=</span> <span class="p">(</span><span class="n">compData</span><span class="p">.</span><span class="n">H2</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">compData</span><span class="p">.</span><span class="n">H2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H3</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H4</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xE5</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H5</span> <span class="o">=</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
  <span class="n">compData</span><span class="p">.</span><span class="n">H6</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">SENSORSS</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">endTransaction</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<h2 id="conclusion">Conclusion</h2>
<p>In conclusion, this project was unsuccessful; however, it can be easily completed given the correct, fully operational, parts. I did enjoy working with ViaCAD to create a clean, accurate final product, and while it may not work as intended, it does look quite nice. This project taught me to <em>always</em> test your components before you leave the lab for a long weekend. While I am wholeheartedly disappointed with the results this far, I am optimistic that I can get this project to achieve its intended purpose. While it was quite difficult, I enjoyed working with only the SPI library to communicate with the BME280 chip as it taught me more about the SPI protocol, how data is stored in peripherals, and how to read (and find issues with) datasheets. I have alerted Bosch of the issue with their datasheet and they have yet alerted me of a change. From the issue with the NeoPixels, I learned how to think quickly and produce a final project with some resemblance to the intended final product. I hope to bring what I learned about communication protocols, sensors, data compensation algorithms and limitations of certain products with me for utilization in future projects.</p>

<h2 id="reference">Reference</h2>
<p>“BME280.” Bosch Sensortec, Bosch, 26 Oct. 2015, <a href="http://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME280_DS001-11.pdf">http://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME280_DS001-11.pdf</a>. Accessed 22 May 2017.</p>

<p>Burgess, Phillip. “Adafruit NeoPixel Überguide.” Adafruit NeoPixel Überguide, Adafruit, 30 Aug. 2013, <a href="http://learn.adafruit.com/adafruit-neopixel-uberguide/overview">http://learn.adafruit.com/adafruit-neopixel-uberguide/overview</a>. Accessed 22 May 2017.</p>
</section>
  
<footer>
  <div class="tags">
    
    <a class="tag" href="/tags#ER">#ER</a>
    
    <a class="tag" href="/tags#ACES">#ACES</a>
    
    <a class="tag" href="/tags#Grade 11">#Grade 11</a>
    
    <a class="tag" href="/tags#ISP">#ISP</a>
    
  </div>
</footer>


</article>

<!-- Disqus -->


<!--ads-->

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- End of Blog ads -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3976272342678634"
     data-ad-slot="5740189100"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


<!-- Post navigation -->

  <div id="post-nav">
  
  <div id="previous-post" class="post-nav-post">
      <p>Previous post</p>
      <a href="/2017/04/30/BiColour-LED-Matrix.html">
        BiColour LED Matrix
      </a>
  </div>
  
  
  <div id="next-post" class="post-nav-post">
      <p>Next post</p>
      <a href="/2017/11/05/Short-ISP.html">
        Short ISP: Relay Logic Adder
      </a>
  </div>
  
</div>



    </div>
    
<script src="/assets/js/katex_init.js"></script>



<footer class="site-footer">
	<p class="text">‍</p>
	<p class="text">© Ethan McAuliffe 2018 | All Rights Reserved.</p>
</footer>


  </body>
</html>
